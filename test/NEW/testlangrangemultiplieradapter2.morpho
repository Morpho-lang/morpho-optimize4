// Test the lagrange multiplier adapter

import optimize4 

import "lagrangemultiplieradapter2.morpho"

//import "../examples/constrainedloop.morpho" for ConstrainedLoop
//var example = ConstrainedLoop(Np=10)
//var adapter = example.build()

import "../examples/constrainedfunction.morpho"
var example = ConstrainedFunctionExample()
var adapter = example.build() 

import "sqpcontroller2.morpho"

adapter.set(Matrix([-0.2,0.5,0.1]))

print adapter.constraintValue()

var control = SQPController(adapter)

control.optimize(20) 
print adapter.get() 
print "lambda:"
print control.ladapter.lagrangeMultipliers()


/*
adapter.set(Matrix([-0.2,0.5,0.1]))
var control = PenaltyController(adapter)
control.optimize(10) 
print adapter.get() */


/*


var ll = ladapter.get() 
ladapter.set(ll)
var uu = ladapter.get() 

print (ll-uu).norm() 

print ladapter.varGradient()

print ladapter.gradient()

print ladapter.lagrangeMultipliers()

//example.visualize() */